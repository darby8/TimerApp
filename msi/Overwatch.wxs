<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <Product
    Id="*"
    Name="Overwatch"
    Language="1033"
    Version="1.0.0"
    Manufacturer="Reak"
    UpgradeCode="7F6B4E8D-1A3C-4F28-9E53-9C5B8A2E41D7">

    <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine"/>
    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed."/>
    <MediaTemplate EmbedCab="yes"/>

    <!-- ========================= -->
    <!-- DIRECTORY STRUCTURE -->
    <!-- ========================= -->

    <Directory Id="TARGETDIR" Name="SourceDir">

      <Directory Id="ProgramFilesFolder">
        <Directory Id="COMPANYDIR" Name="Reak">
          <Directory Id="INSTALLDIR" Name="Overwatch"/>
        </Directory>
      </Directory>

      <Directory Id="DesktopFolder"/>

      <Directory Id="ProgramMenuFolder">
        <Directory Id="StartMenuDir" Name="Overwatch"/>
      </Directory>

    </Directory>

    <!-- ========================= -->
    <!-- MAIN APP FILE -->
    <!-- ========================= -->

    <DirectoryRef Id="INSTALLDIR">
      <Component Id="MainExecutable" Guid="*">
        <File Source="msi\layout\appproject-overwatch.exe" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- ========================= -->
    <!-- DESKTOP SHORTCUT -->
    <!-- ========================= -->

    <DirectoryRef Id="DesktopFolder">
      <Component Id="DesktopShortcut" Guid="*">
        <Shortcut
          Id="DesktopShortcut"
          Name="Overwatch"
          Target="[INSTALLDIR]appproject-overwatch.exe"
          WorkingDirectory="INSTALLDIR"/>

        <RegistryValue Root="HKCU"
                       Key="Software\Reak\Overwatch"
                       Name="Desktop"
                       Type="integer"
                       Value="1"
                       KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- ========================= -->
    <!-- START MENU SHORTCUT -->
    <!-- ========================= -->

    <DirectoryRef Id="StartMenuDir">
      <Component Id="StartMenuShortcut" Guid="*">
        <Shortcut
          Id="StartMenuShortcut"
          Name="Overwatch"
          Target="[INSTALLDIR]appproject-overwatch.exe"
          WorkingDirectory="INSTALLDIR"/>

        <RemoveFolder Id="RemoveStartMenuDir" On="uninstall"/>

        <RegistryValue Root="HKCU"
                       Key="Software\Reak\Overwatch"
                       Name="StartMenu"
                       Type="integer"
                       Value="1"
                       KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- ========================= -->
    <!-- STARTUP REGISTRY (ALL USERS) -->
    <!-- ========================= -->

    <Component Id="StartupRegistry" Directory="TARGETDIR" Guid="*">
      <RegistryValue
        Root="HKLM"
        Key="Software\Microsoft\Windows\CurrentVersion\Run"
        Name="Overwatch"
        Value="[INSTALLDIR]appproject-overwatch.exe"
        Type="string"
        KeyPath="yes"/>
    </Component>

    <!-- ========================= -->
    <!-- REMOVE APPDATA EXACT LIKE NSIS -->
    <!-- ========================= -->

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR"/>

    <CustomAction Id="DeleteUserData"
                  Execute="deferred"
                  Impersonate="no"
                  ExeCommand='cmd.exe /c if exist "%APPDATA%\Reak\Overwatch" rmdir /s /q "%APPDATA%\Reak\Overwatch"'/>

    <InstallExecuteSequence>
      <Custom Action="DeleteUserData" After="RemoveFiles">REMOVE="ALL"</Custom>
    </InstallExecuteSequence>

    <!-- ========================= -->
    <!-- FEATURES -->
    <!-- ========================= -->

    <Feature Id="MainFeature" Title="Overwatch" Level="1">
      <ComponentRef Id="MainExecutable"/>
      <ComponentRef Id="DesktopShortcut"/>
      <ComponentRef Id="StartMenuShortcut"/>
      <ComponentRef Id="StartupRegistry"/>
    </Feature>

  </Product>

</Wix>
